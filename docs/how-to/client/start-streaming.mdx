---
sidebar_position: 3
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Streaming media

## Initialize access to your devices

<Tabs groupId="platform">
  <TabItem value="web" label="React (Web)">

Fishjam provides an API to browse and manage media devices you can use.  
To ask the browser for permission to list the available devices,
call the [`initializeDevices`](../../api/web/functions/useInitializeDevices#initializedevices)
function from [`useInitializeDevices`](../../api/web/functions/useInitializeDevices) hook.

You can choose whether to initialize both camera and microphone devices or just one of them by passing [`InitializeDevicesSettings`](../../api/web/type-aliases/InitializeDevicesSettings)
as an argument. By default, both camera and microphone are initialized.

The [`initializeDevices`](../../api/web/functions/useInitializeDevices#initializedevices) function will return a [`Promise<InitializeDevicesResult>`](../../api/web/type-aliases/InitializeDevicesResult) object.

```ts
import React, { useEffect } from "react";
import { useInitializeDevices } from "@fishjam-cloud/react-client";

export function useExample() {
  const { initializeDevices } = useInitializeDevices();

  useEffect(() => {
    initializeDevices().then((result) => {
      // optionally handle the result
      console.log(result);
    });
  }, [initializeDevices]);
}
```

:::note
The [`useInitializeDevices`](../../api/web/functions/useInitializeDevices) hook gives you the convenience of asking the user for all permissions at once.

It is not the only way to enable the device. You can just toggle the device using [`useCamera`](../../api/web/functions/useCamera) or [`useMicrophone`](../../api/web/functions/useMicrophone) hooks.
:::

  </TabItem>
  <TabItem value="mobile" label="React Native (Mobile)">

On mobile, the SDK automatically requests camera and microphone permissions when you call [`startCamera`](../../api/mobile/functions/useCamera#startcamera) or [`startMicrophone`](../../api/mobile/functions/useMicrophone#startmicrophone). You can also use `initializeDevices()` to request permissions upfront.

  </TabItem>
</Tabs>

## Camera API

To manage users' camera devices, use the [`useCamera`](../../api/web/functions/useCamera) hook.

<Tabs groupId="platform">
  <TabItem value="web" label="React (Web)">

```tsx
import React, { useEffect, useRef } from "react";
import { useCamera } from "@fishjam-cloud/react-client";

export function ExampleCameraPreview() {
  const videoRef = useRef<HTMLVideoElement>(null);

  const { activeCamera, selectCamera, cameraStream, cameraDevices } =
    useCamera(); // [!code highlight]

  useEffect(() => {
    if (!videoRef.current) return;
    videoRef.current.srcObject = cameraStream ?? null;
  }, [cameraStream]);

  return (
    <div>
      <p>Active camera: {activeCamera?.label ?? "None"}</p>
      <select onChange={(e) => selectCamera(e.target.value)}>
        {cameraDevices.map(({ label, deviceId }) => (
          <option key={deviceId} value={deviceId}>
            {label}
          </option>
        ))}
      </select>
      {cameraStream && <video ref={videoRef} autoPlay />} // [!code highlight]
    </div>
  );
}
```

  </TabItem>
  <TabItem value="mobile" label="React Native (Mobile)">

First, you have to enable your camera by calling [`startCamera`](../../api/mobile/functions/useCamera#startcamera) method.
You can show camera preview with `RTCView` component.

```tsx
import React, { useEffect } from "react";
import { View, Text } from "react-native";
import { useCamera, RTCView } from "@fishjam-cloud/mobile-client";

//TODO: FCE-2487 remove it when MediaStream will be updated
interface MediaStreamWithURL extends MediaStream {
  toURL(): string;
}

export function CameraPreview() {
  const { startCamera, cameraStream } = useCamera(); // [!code highlight]

  useEffect(() => {
    startCamera(); // [!code highlight]
  }, [startCamera]);

  const streamURL = cameraStream
    ? (cameraStream as MediaStreamWithURL).toURL()
    : null;

  return (
    <View>
      {streamURL ? (
        <RTCView
          streamURL={streamURL}
          style={{ height: 300, width: 300 }}
          objectFit="cover"
          mirror={true}
        />
      ) : (
        <Text>No camera stream</Text>
      )}
    </View>
  );
}
```

  </TabItem>
</Tabs>

### Listing user cameras

To list all cameras available on the device, you can use the `cameraDevices` property from the `useCamera` hook.

<Tabs groupId="platform">
  <TabItem value="web" label="React (Web)">

```tsx
import React from "react";
import { useCamera } from "@fishjam-cloud/react-client";

export function CameraSelector() {
  const { cameraDevices, selectCamera, activeCamera } = useCamera();

  return (
    <select 
      value={activeCamera?.deviceId ?? ""} 
      onChange={(e) => selectCamera(e.target.value)}
    >
      {cameraDevices.map(({ label, deviceId }) => (
        <option key={deviceId} value={deviceId}>
          {label}
        </option>
      ))}
    </select>
  );
}
```

  </TabItem>
  <TabItem value="mobile" label="React Native (Mobile)">

To change camera, simply call [`selectCamera`](../../api/mobile/functions/useCamera#selectcamera) method.

```tsx
import React, { useCallback, useState } from "react";
import { Button } from "react-native";
import { useCamera, DeviceItem } from "@fishjam-cloud/mobile-client";

export function FlipButton() {
  const { cameraDevices, selectCamera, currentCamera } = useCamera(); // [!code highlight]
  const [currentIndex, setCurrentIndex] = useState(0);

  const onPressFlipCamera = useCallback(() => {
    if (cameraDevices.length === 0) return;

    // Cycle through available cameras
    const nextIndex = (currentIndex + 1) % cameraDevices.length;
    const nextCamera = cameraDevices[nextIndex];
    if (nextCamera) {
      selectCamera(nextCamera.deviceId); // [!code highlight]
      setCurrentIndex(nextIndex);
    }
  }, [cameraDevices, currentIndex, selectCamera]);

  return <Button onPress={onPressFlipCamera} title="Flip Camera" />;
}
```

  </TabItem>
</Tabs>

### Disabling/enabling camera

<Tabs groupId="platform">
  <TabItem value="web" label="React (Web)">

Use the `toggleCamera` method from the `useCamera` hook to toggle the camera state.

```tsx
import React from "react";
import { useCamera } from "@fishjam-cloud/react-client";

export function ToggleCameraButton() {
  const { isCameraOn, toggleCamera } = useCamera();

  return (
    <button onClick={toggleCamera}>
      {isCameraOn ? "Disable camera" : "Enable camera"}
    </button>
  );
}
```

  </TabItem>
  <TabItem value="mobile" label="React Native (Mobile)">

To change camera state, use the [`toggleCamera`](../../api/mobile/functions/useCamera#togglecamera) method.

```tsx
import { Button } from "react-native";
import React from "react";
import { useCamera } from "@fishjam-cloud/mobile-client";

export function ToggleCameraButton() {
  const { isCameraOn, toggleCamera } = useCamera(); // [!code highlight]

  return (
    <Button
      onPress={toggleCamera} // [!code highlight]
      title={isCameraOn ? "Disable camera" : "Enable camera"}
    />
  );
}
```

  </TabItem>
</Tabs>

## Microphone API

Microphone works similar to camera. Use the [`useMicrophone`](../../api/web/functions/useMicrophone) hook to manage the microphone.

<Tabs groupId="platform">
  <TabItem value="web" label="React (Web)">

```tsx
import React from "react";
import { useMicrophone } from "@fishjam-cloud/react-client";

export function ToggleMicrophoneButton() {
  const { isMicrophoneOn, toggleMicrophone } = useMicrophone();

  return (
    <button onClick={toggleMicrophone}>
      {isMicrophoneOn ? "Mute" : "Unmute"}
    </button>
  );
}
```

  </TabItem>
  <TabItem value="mobile" label="React Native (Mobile)">

In order to enable it, you have to call [`toggleMicrophone`](../../api/mobile/functions/useMicrophone#togglemicrophone) method.

```tsx
import { Button } from "react-native";
import React from "react";
import { useMicrophone } from "@fishjam-cloud/mobile-client";

export function ToggleMicrophoneButton() {
  const { isMicrophoneOn, toggleMicrophone } = useMicrophone(); // [!code highlight]

  return (
    <Button
      onPress={toggleMicrophone} // [!code highlight]
      title={isMicrophoneOn ? "Disable microphone" : "Enable microphone"}
    />
  );
}
```

  </TabItem>
</Tabs>

