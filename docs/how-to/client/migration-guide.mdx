---
sidebar_position: 0
sidebar_label: "Migration Guide"
---

# Migration Guide: From @fishjam-cloud/react-native-client to @fishjam-cloud/mobile-client

This guide will help you migrate your React Native application from `@fishjam-cloud/react-native-client` to `@fishjam-cloud/mobile-client`.

## Overview

The new `@fishjam-cloud/mobile-client` package provides a more consistent API across web and mobile platforms, improved TypeScript support, and better integration with React's context system.

## Package Installation

### Before

```bash
npm install @fishjam-cloud/react-native-client
```

### After

```bash
npm install @fishjam-cloud/mobile-client
```

Update all your imports:

```tsx
// Before
import { ... } from "@fishjam-cloud/react-native-client";

// After
import { ... } from "@fishjam-cloud/mobile-client";
```

## Required Android Permissions

Add the following WebRTC permissions to your Android configuration:

### Expo

Add to `app.json`:

```json
{
  "expo": {
    "android": {
      "permissions": [
        "android.permission.CAMERA",
        "android.permission.RECORD_AUDIO",
        "android.permission.MODIFY_AUDIO_SETTINGS",
        "android.permission.ACCESS_NETWORK_STATE",
        "android.permission.ACCESS_WIFI_STATE"
      ]
    }
  }
}
```

### Bare React Native

Add to `AndroidManifest.xml`:

```xml
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/>
<uses-permission android:name="android.permission.ACCESS_WIFI_STATE"/>
```

## FishjamProvider Setup

The new package requires wrapping your app with `FishjamProvider` to provide the Fishjam ID context.

### Before

```tsx
import { FishjamRoom } from "@fishjam-cloud/react-native-client";

// fishjamId was passed directly to joinRoom
await joinRoom({ fishjamId: "your-fishjam-id", peerToken: "..." });
```

### After

```tsx
import { FishjamProvider } from "@fishjam-cloud/mobile-client";

// Wrap your app with FishjamProvider
export default function App() {
  return (
    <FishjamProvider fishjamId="YOUR_FISHJAM_ID">
      <YourApp />
    </FishjamProvider>
  );
}
```

The `fishjamId` is now provided through the context, so you no longer need to pass it to `joinRoom` or `useSandbox`.

## Device Initialization

### Before

```tsx
import { useCamera } from "@fishjam-cloud/react-native-client";

const { prepareCamera } = useCamera();

await prepareCamera({ cameraEnabled: true });
```

### After

```tsx
import { useInitializeDevices } from "@fishjam-cloud/mobile-client";

const { initializeDevices } = useInitializeDevices();

// Initialize devices when you first want to stream
await initializeDevices({ enableAudio: false }); // or initializeDevices() for both
```

:::important
On mobile, you should use `initializeDevices()` when you first want to stream. This gives your app access to all available devices and automatically requests camera and microphone permissions. After initialization, you can use `startCamera`/`stopCamera` or `startMicrophone`/`stopMicrophone` to manage device state.
:::

## Video Rendering

### Before

```tsx
import { VideoRendererView } from "@fishjam-cloud/react-native-client";

<VideoRendererView
  trackId={peer.track.id}
  style={{ width: 300, height: 200 }}
/>
```

### After

```tsx
import { RTCView } from "@fishjam-cloud/mobile-client";

//TODO: FCE-2487 remove it when MediaStream will be updated
interface MediaStreamWithURL extends MediaStream {
  toURL(): string;
}

function VideoPlayer({ stream }: { stream: MediaStream | null | undefined }) {
  const streamURL = stream ? (stream as MediaStreamWithURL).toURL() : null;

  if (!streamURL) return null;

  return (
    <RTCView
      streamURL={streamURL}
      style={{ width: 300, height: 200 }}
      objectFit="cover"
    />
  );
}

// Usage with peer camera track
{peer.cameraTrack?.stream && (
  <VideoPlayer stream={peer.cameraTrack.stream} />
)}
```

Key changes:
- `VideoRendererView` → `RTCView`
- `trackId` prop → `streamURL` prop
- Use `stream.toURL()` to get the URL from a MediaStream
- Access peer video via `peer.cameraTrack.stream` instead of `peer.track`

## Connection API

### Before

```tsx
import { useConnection, useSandbox } from "@fishjam-cloud/react-native-client";

const { joinRoom } = useConnection();
const { getSandboxPeerToken } = useSandbox({ fishjamId: "your-id" });

const peerToken = await getSandboxPeerToken(roomName, peerName);
await joinRoom({ fishjamId: "your-id", peerToken });
```

### After

```tsx
import { useConnection, useSandbox } from "@fishjam-cloud/mobile-client";

const { joinRoom } = useConnection();
// fishjamId is now provided through FishjamProvider
const { getSandboxPeerToken } = useSandbox();

const peerToken = await getSandboxPeerToken(roomName, peerName);
await joinRoom({ peerToken }); // fishjamId removed
```

## Device Management

### Camera Device Selection

#### Before

```tsx
const { cameras, switchCamera, facingDirection } = useCamera();

// Switch camera
switchCamera(facingDirection === "front" ? "back" : "front");
```

#### After

```tsx
const { cameraDevices, selectCamera } = useCamera();

// Select camera by deviceId
const nextCamera = cameraDevices[0];
if (nextCamera) {
  selectCamera(nextCamera.deviceId);
}
```

Key changes:
- `cameras` → `cameraDevices`
- `switchCamera` → `selectCamera` (takes `deviceId` instead of direction)
- `facingDirection` property removed

### Camera Control

#### Before

```tsx
const { prepareCamera } = useCamera();
await prepareCamera({ cameraEnabled: true });
```

#### After

```tsx
const { startCamera, stopCamera, toggleCamera } = useCamera();

// Start camera
await startCamera();

// Stop camera
await stopCamera();

// Toggle camera
toggleCamera();
```

## Screen Sharing

### Before

```tsx
import { useScreenShare } from "@fishjam-cloud/react-native-client";

const { toggleScreenShare, isScreenShareOn } = useScreenShare();

<Button
  onPress={toggleScreenShare}
  title={isScreenShareOn ? "Disable" : "Enable"}
/>
```

### After

```tsx
import { useScreenShare } from "@fishjam-cloud/mobile-client";

const { startStreaming, stopStreaming, stream } = useScreenShare();

const onPressToggle = () => {
  if (stream) {
    stopStreaming();
  } else {
    startStreaming();
  }
};

<Button
  onPress={onPressToggle}
  title={stream ? "Disable" : "Enable"}
/>
```

Key changes:
- `toggleScreenShare()` → `startStreaming()` / `stopStreaming()`
- `isScreenShareOn` → check if `stream` exists

## Picture in Picture

### Before

```tsx
import { PipContainerView } from "@fishjam-cloud/react-native-client";

<PipContainerView
  trackId={peer.track.id}
  style={{ width: 300, height: 200 }}
/>
```

### After

```tsx
import { RTCPIPView, startPIP, stopPIP } from "@fishjam-cloud/mobile-client";

//TODO: FCE-2487 remove it when MediaStream will be updated
interface MediaStreamWithURL extends MediaStream {
  toURL(): string;
}

const pipViewRef = useRef<React.ElementRef<typeof RTCPIPView>>(null);
const streamURL = stream ? (stream as MediaStreamWithURL).toURL() : null;

<RTCPIPView
  ref={pipViewRef}
  streamURL={streamURL}
  style={{ width: 300, height: 200 }}
  pip={{
    startAutomatically: true,
    stopAutomatically: true,
    enabled: true,
  }}
/>

// Manual control
<Button title="Start PiP" onPress={() => startPIP(pipViewRef as any)} />
<Button title="Stop PiP" onPress={() => stopPIP(pipViewRef as any)} />
```

Key changes:
- `PipContainerView` → `RTCPIPView`
- `trackId` prop → `streamURL` prop
- Requires a ref for manual `startPIP`/`stopPIP` control
- Added `pip` prop for configuration

## Livestreaming Imports

### Before

```tsx
import {
  useLivestreamStreamer,
  useLivestreamViewer,
} from "@fishjam-cloud/react-native-client/livestream";
```

### After

```tsx
import {
  useLivestreamStreamer,
  useLivestreamViewer,
} from "@fishjam-cloud/mobile-client";
```

The livestreaming hooks are now exported from the main package instead of a separate `/livestream` subpath.

## Removed Hooks and APIs

The following hooks and APIs have been removed and are no longer available:

### Permission Hooks

#### Before

```tsx
import {
  useCameraPermissions,
  useMicrophonePermissions,
} from "@fishjam-cloud/react-native-client";

const [cameraPermission, requestCameraPermission] = useCameraPermissions();
const [micPermission, requestMicPermission] = useMicrophonePermissions();
```

#### After

Permissions are now handled automatically by the SDK. When you call `initializeDevices()`, the SDK will automatically request camera and microphone permissions if they haven't been granted yet.

### CallKit Hooks

#### Before

```tsx
import {
  useCallKit,
  useCallKitService,
  useCallKitEvent,
} from "@fishjam-cloud/react-native-client";

// Manual CallKit control
const { startCallKitSession, endCallKitSession } = useCallKit();

// Automatic CallKit service
useCallKitService({
  displayName: "User Name",
  isVideo: true,
});

// CallKit events
useCallKitEvent("muted", (isMuted) => {
  // Handle mute event
});
```

#### After

CallKit integration is now handled automatically by the SDK when VoIP background mode is enabled. You no longer need to manually manage CallKit sessions.

To enable background calls on iOS:

**Expo:**
```json
{
  "expo": {
    "plugins": [
      [
        "@fishjam-cloud/mobile-client",
        {
          "ios": {
            "enableVoIPBackgroundMode": true
          }
        }
      ]
    ]
  }
}
```

**Bare React Native:**
Add to `Info.plist`:
```xml
<key>UIBackgroundModes</key>
<array>
  <string>voip</string>
</array>
```

## Accessing Peer Tracks

### Before

```tsx
// Accessing tracks
{peer.tracks.map((track) => {
  if (track.type === "video") {
    return <VideoRendererView trackId={track.id} />;
  }
})}

// Checking if track is active
if (track.isActive) {
  // ...
}
```

### After

```tsx
// Access camera track directly
{peer.cameraTrack?.stream && (
  <VideoPlayer stream={peer.cameraTrack.stream} />
)}

// Access microphone track
{peer.microphoneTrack?.stream && (
  // Handle audio track
)}
```

Key changes:
- `peer.tracks` array → `peer.cameraTrack` and `peer.microphoneTrack` properties
- `track.isActive` removed (check if stream exists instead)
- `track.type` removed (use specific track properties)

## Complete Migration Example

### Before

```tsx
import React, { useEffect } from "react";
import { View, Button } from "react-native";
import {
  FishjamRoom,
  VideoRendererView,
  useCamera,
  useConnection,
  useSandbox,
} from "@fishjam-cloud/react-native-client";

const FISHJAM_ID = "your-fishjam-id";

export function VideoCall() {
  const { prepareCamera } = useCamera();
  const { joinRoom } = useConnection();
  const { getSandboxPeerToken } = useSandbox({ fishjamId: FISHJAM_ID });

  useEffect(() => {
    const connect = async () => {
      await prepareCamera({ cameraEnabled: true });
      const peerToken = await getSandboxPeerToken("room", "user");
      await joinRoom({ fishjamId: FISHJAM_ID, peerToken });
    };
    connect();
  }, []);

  return (
    <View>
      <VideoRendererView trackId="local-track" />
    </View>
  );
}
```

### After

```tsx
import React, { useEffect } from "react";
import { View } from "react-native";
import {
  FishjamProvider,
  RTCView,
  useCamera,
  useConnection,
  useSandbox,
  useInitializeDevices,
} from "@fishjam-cloud/mobile-client";

const FISHJAM_ID = "your-fishjam-id";

//TODO: FCE-2487 remove it when MediaStream will be updated
interface MediaStreamWithURL extends MediaStream {
  toURL(): string;
}

function VideoCall() {
  const { initializeDevices } = useInitializeDevices();
  const { cameraStream } = useCamera();
  const { joinRoom } = useConnection();
  const { getSandboxPeerToken } = useSandbox();

  useEffect(() => {
    const connect = async () => {
      await initializeDevices();
      const peerToken = await getSandboxPeerToken("room", "user");
      await joinRoom({ peerToken });
    };
    connect();
  }, []);

  const streamURL = cameraStream
    ? (cameraStream as MediaStreamWithURL).toURL()
    : null;

  return (
    <View>
      {streamURL && (
        <RTCView
          streamURL={streamURL}
          style={{ width: 300, height: 200 }}
          objectFit="cover"
        />
      )}
    </View>
  );
}

export default function App() {
  return (
    <FishjamProvider fishjamId={FISHJAM_ID}>
      <VideoCall />
    </FishjamProvider>
  );
}
```

## Summary of Changes

| Old API | New API | Notes |
|---------|---------|-------|
| `@fishjam-cloud/react-native-client` | `@fishjam-cloud/mobile-client` | Package name change |
| `prepareCamera()` | `initializeDevices()` | Device initialization |
| `VideoRendererView` | `RTCView` | Video rendering component |
| `trackId` prop | `streamURL` prop | Video rendering prop |
| `peer.track` | `peer.cameraTrack` | Peer track access |
| `joinRoom({ fishjamId, peerToken })` | `joinRoom({ peerToken })` | fishjamId from provider |
| `useSandbox({ fishjamId })` | `useSandbox()` | fishjamId from provider |
| `cameras` | `cameraDevices` | Camera device list |
| `switchCamera()` | `selectCamera(deviceId)` | Camera selection |
| `toggleScreenShare()` | `startStreaming()` / `stopStreaming()` | Screen sharing |
| `isScreenShareOn` | `stream` (check existence) | Screen sharing state |
| `PipContainerView` | `RTCPIPView` | Picture in Picture |
| `useCameraPermissions()` | Removed | Auto-handled |
| `useMicrophonePermissions()` | Removed | Auto-handled |
| `useCallKit()` | Removed | Auto-handled |
| `useCallKitService()` | Removed | Auto-handled |
| `useCallKitEvent()` | Removed | Auto-handled |

## Need Help?

If you encounter any issues during migration, please:

1. Check the [API documentation](../../api/mobile/index) for the new package
2. Review the [React Native Quick Start tutorial](../../tutorials/react-native-quick-start)
3. Open an issue on our [GitHub repository](https://github.com/fishjam-cloud/web-client-sdk)

