---
sidebar_position: 6
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Background calls

Both Android and iOS support calls running in the background, but they use different approaches:

- **Android**: Uses foreground services to keep the app active in the background
- **iOS**: Uses CallKit integration to maintain VoIP calls in the background

Below is configuration required to make it work:

<Tabs groupId="app-type">

  <TabItem value="expo" label="Expo">

You need to modify `app.json` file and add our plugin:

```json
{
  "expo": {
    ...
    "plugins": {
      ...
      [
        "@fishjam-cloud/mobile-client",
        {
          "android": {
            "enableForegroundService": true
          },
          "ios": {
            "enableVoIPBackgroundMode": true
          }
        }
      ],
      ...
    }
  }
}
```

  </TabItem>
  <TabItem value="rn" label="Bare workflow">

**Android Configuration**

You need to add the following service to `AndroidManifest.xml`:

```xml title='AndroidManifest.xml'
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
  ...
  <application ...>
    ...
    <service android:name="io.fishjam.reactnative.FishjamForegroundService" android:foregroundServiceType="camera|microphone|mediaProjection"/>
  </application>
</manifest>
```

**iOS Configuration**

You need to add VoIP background mode in `Info.plist`:

```xml title='Info.plist'
<key>UIBackgroundModes</key>
<array>
  <string>voip</string>
</array>
```

  </TabItem>
</Tabs>

## Usage

<Tabs groupId="platform">

  <TabItem value="android" label="Android">

You can use [`useForegroundService`](../../api/mobile/variables/useForegroundService) hook to handle how foreground service behaves on Android.

:::important[Permissions]

If you want to use [`enableCamera`](../../api/mobile/type-aliases/ForegroundServiceConfig#enablecamera) or [`enableMicrophone`](../../api/mobile/type-aliases/ForegroundServiceConfig#enablemicrophone),
user must first grant permission for this resource. [`useForegroundService`](../../api/mobile/variables/useForegroundService) will check if permission is
granted and only then allow to start a service.

:::

```tsx
import {
  useCamera,
  useMicrophone,
} from "@fishjam-cloud/mobile-client";

const { isCameraOn } = useCamera();
const { isMicrophoneOn } = useMicrophone();


```

  </TabItem>
  <TabItem value="ios" label="iOS">

On iOS, background calls are achieved through CallKit integration. To enable background streaming on iOS:

1. Enable VoIP background mode by setting `enableVoIPBackgroundMode: true` in the plugin configuration or adding the VoIP background mode to your `Info.plist`
2. The SDK will automatically handle CallKit integration for maintaining background audio/video sessions

:::note
CallKit integration is handled automatically by the SDK when VoIP background mode is enabled. The call will appear in the iOS call history and can be managed through the native phone interface.
:::

  </TabItem>
</Tabs>

## See Also

For an enhanced user experience when your app is in the background, consider enabling [Picture in Picture](./picture-in-picture), which allows users to see video content in a floating window while using other apps.
