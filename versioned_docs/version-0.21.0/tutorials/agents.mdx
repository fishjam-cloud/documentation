---
type: tutorial
sidebar_position: 4
title: Agents
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import AgentDefinition from "../_common/agents/definition.mdx";
import Subscriptions from "../_common/agents/subscriptions.mdx";

# Fishjam Agent Introduction

:::tip
We recommend going through the steps in the [Backend Quick Start](../tutorials/backend-quick-start)
before trying Fishjam agents, as you will need a working backend server to use them.
:::

This page gives an introduction to Fishjam agents and how to use them.
You can learn more about how Agents work on the [Agent Internals](../explanation/agent-internals) page.

<AgentDefinition />

## Writing an Agent

In this section we show how to implement an agent using the Fishjam server SDKs.
If you are not using the SDKs, then you can check out the [Agent Internals](../explanation/agent-internals#agent-lifecycle), to learn how to integrate with Fishjam Agents.

### Prerequisites

#### Room

To create an agent, you first need a room, as agents are scoped to rooms.
[This Backend Quick Start section](../tutorials/backend-quick-start#step-4-create-a-room) explains how to create a room, but the TL;DR is:

<Tabs groupId="language">
  <TabItem value="ts" label="TypeScript">
  
    ```ts
    const fishjamId = "";
    const managementToken = "";
    
    // ---cut---
    import { FishjamClient } from '@fishjam-cloud/js-server-sdk';

    const fishjamClient = new FishjamClient({ fishjamId, managementToken });

    // [!code highlight:1]
    const room = await fishjamClient.createRoom();
    ```

  </TabItem>

  <TabItem value="python" label="Python">

    ```python
    from fishjam import FishjamClient

    fishjam_client = FishjamClient(fishjam_id, management_token)

    # [!code highlight:1]
    room = fishjam_client.create_room()
    ```

  </TabItem>
</Tabs>

#### Peer subscriptions

<Subscriptions />

<Tabs groupId="language">
  <TabItem value="ts" label="TypeScript">
  
    ```ts
    import { RoomId } from '@fishjam-cloud/js-server-sdk';
    const fishjamId = '';
    const managementToken = '';
    const roomId = '' as RoomId;

    // ---cut---
    import { FishjamClient } from '@fishjam-cloud/js-server-sdk';

    const fishjamClient = new FishjamClient({ fishjamId, managementToken });

    const peer = await fishjamClient.createPeer(
      roomId,
      // [!code highlight:1]
      { subscribe: { audioFormat: 'pcm16', audioSampleRate: 16000 } },
    );
    // Agents will receive peer's audio streams as raw PCM audio with 16kHz sample rate
    ```

  </TabItem>

  <TabItem value="python" label="Python">

    ```python
    from fishjam import FishjamClient, PeerOptions
    from fishjam.agent import AgentResponseTrackData
    from fishjam.peer import (
      SubscribeOptions,
      SubscribeOptionsAudioFormat,
      SubscribeOptionsAudioSampleRate
    )

    fishjam_client = FishjamClient(fishjam_id, management_token)

    peer = fishjam_client.create_peer(
      room_id,
      options=PeerOptions(
        # [!code highlight:4]
        subscribe=SubscribeOptions(
          audio_format=SubscribeOptionsAudioFormat.PCM_16,
          audio_sample_rate=SubscribeOptionsAudioSampleRate.VALUE_16000,
        )
      )
    )
    # Agents will receive peer's audio streams as raw PCM audio with 16kHz sample rate
    ```

  </TabItem>

</Tabs>

### Creating an Agent

If you are using the server SDKs, then creating an agent and defining its behavior is very simple.

<Tabs groupId="language">
  <TabItem value="ts" label="TypeScript">
  
    ```ts
    import { RoomId } from '@fishjam-cloud/js-server-sdk';
    const fishjamId = '';
    const managementToken = '';
    const roomId = '' as RoomId;

    // ---cut---
    import { FishjamClient, IncomingTrackData } from '@fishjam-cloud/js-server-sdk';

    const fishjamClient = new FishjamClient({ fishjamId, managementToken });

    const { agent } = await fishjamClient.createAgent(
      roomId,
      {},
      console.error,
      (code: number, reason: string) => console.log(`Agent disconnected with code: ${code} and reason: ${reason}`)
    );
    // Register callback for incoming audio data
    agent.on('trackData', ({ track, peerId, data }: IncomingTrackData) => {
      // process the incoming data
    })
    ```

  </TabItem>

  <TabItem value="python" label="Python">

    ```python
    from fishjam import FishjamClient
    from fishjam.agent import AgentResponseTrackData

    fishjam_client = FishjamClient(fishjam_id, management_token)

    agent = fishjam_client.create_agent(room_id)
    # Register callback for incoming audio data
    @agent.on_track_data
    def _(data: AgentResponseTrackData):
      pass

    # Option 1: connect/disconnect manually
    await agent.connect()
    ...
    await agent.disconnect()

    # Option 2: context manager
    async with agent:
      ...
    ```

  </TabItem>

</Tabs>

If you are using Fishjam's REST API directly, then check out this [Agent Internals section](../explanation/agent-internals#rest-api).

## Pricing

Agents are billed as if they were normal peers.

For example, a room with 2 peers and 1 agent connected will be billed as if there were 3 peers connected to the room.
Exact pricing values can be found on our [pricing page](https://fishjam.io/#pricing).

## See also

Learn more about how agents work:

- [Agent Internals](../explanation/agent-internals)

Writing a backend server with Fishjam:

- [Backend Quick Start](../tutorials/backend-quick-start)
- [How to Setup a Backend Server](../how-to/backend/server-setup)
- [Going to Production](../how-to/backend/production-deployment)
